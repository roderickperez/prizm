Clear output sheet Sheet []
New folder  [Folder-1] Name [AV_Simulated_maps]  [Reference to an object-1]
New folder  [Folder-1] Name [D_Simulated_maps]  [Reference to an object-2]
New folder  [Folder-2] Name [Culminations_<simulated_D_maps>]  [Reference to an object-3]
New folder  [Folder-2] Name [Countours maps]  [Reference to an object-4]
New folder  [Folder-2] Name [Splitted Polygons]  [Reference to an object-5]
Comments  [Set Variable M = TWT deterministic map]
Comments  [Set variable AA = Isoprobability map TOTAL   ------    Set variable AC = isoprobability map of the specific simulated Depth map]
Set reference  [Reference to an object-6] = [Regular surface-1]
Set reference  [Reference to an object-7] = [Regular surface-2]
Set reference  [Reference to an object-8] = [Regular surface-3]
Z = Constant  [NONE] Constant [0.4]
Z = Constant  [NONE] Constant [0]
For loop Variable [$N] From [1] To [20]
   Comments  [This loop will generate 250 AV maps by a Gaussian distribution]
   Comments  [This loop will then calculate 250 D maps; it will detect the Spill Point for each of these maps and, eventually,]
   Comments  [ it will calculate the Volume below the Depth Map and above the Spill Point ]
   Set reference  [Reference to an object-9] = [Regular surface-4]
   Copy A reference subject [Reference to an object-10] = [Regular surface-4] Folder to copy it into [NONE]
   Set reference  [Reference to an object-11] = [Regular surface-5]
   Copy A reference subject [Reference to an object-12] = [Regular surface-5] Folder to copy it into [NONE]
   Comments  [AV simulated map creation: for each node in the map calculates a random value by a Gaussian Distribution]
   Comments  [with Z as mean and Constant as Standard Deviation]
   Z = Normal(Z, Constant)  [NONE] Constant [45.5]
   Smooth  [NONE] Iterations [1] Filter width [3] Select method [<???>] Fault polygons [NONE]
   Get calculator name  [$AV]  [NONE]
   Get calculator name  [$TWT]  [NONE]
   Get calculator name  [$Depth]  [NONE]
   Comments  [It calculates a Depth simulated map(s) from TWT Deterministic map and AV simulated map(s) > 250 maps]
   Surface calculator Use filter [FALSE] Expression or file [$Depth=$TWT*$AV/2000] Use file [FALSE]
   Get name  [$Name1]  [NONE]
   Get name  [$Name2]  [NONE]
   Set name  [NONE] Name [$Name1$N]
   Set name  [NONE] Name [$Name2$N]
   Eliminate outside  [NONE] The boundary [Lines/polygons-1]
   Comments  [It creates a file with the contours of the variable S (simulated Depth map)]
   Create contours  [NONE] Increment [2] Max level count [1500] Smooth contours [FALSE]
   Set reference  [Reference to an object-13] = [NONE]
   Comments  [Find the culmination of the structure]
   Get Zmax value of data  [$Culmination] = Zmax value of [NONE]
   Comments  [Create a file with ONE POINT = culmination]
   Copy A reference subject [Reference to an object-14] = [NONE] Folder to copy it into [NONE]
   Z < Constant  [NONE] Constant [UNDEF] Exact intersection [FALSE]
   Comments  [Get X and Y of the culmination point]
   Get Xmin value of data  [$Xmin] = Xmin value of [NONE]
   Get Ymin value of data  [$Ymin] = Ymin value of [NONE]
   Numeric expression  [$X] = [$Xmin]
   Numeric expression  [$Y] = [$Ymin]
   Comments  [First Polygon (contour to test > 2 meters below the culmination]
   Numeric expression  [$C] = [$Culmination-2]
   For loop Variable [$I] From [1] To [1000]
      Comments  [This loop has to be run for an undefined number of steps.]
      Comments  [1000 is just a number big enough to check all the polygons (contours) from the top to the Spill Point]
      Copy A reference subject [Reference to an object-15] = [NONE] Folder to copy it into [NONE]
      Numeric expression  [$C] = [$C-2]
      Z > Constant  [NONE] Constant [UNDEF] Exact intersection [FALSE]
      Z <= Constant  [NONE] Constant [UNDEF] Exact intersection [FALSE]
      Comments  [Variable C is made now by just 1 polygon (contour). Each Step increase the polygon depth of 2 meters]
      Comments  [Split Variable G POLYGONS]
      Append polygons  [NONE] Polygon to append [Lines/polygons-2] Append attributes [TRUE]
      Comments  [Utility ia a Polygon outside the area of the closure to avoid an error: with the firsts contours we have just 1 polygon. Thus we can't split it]
      Split polygons into several polygons  [NONE]
      Set reference  [Reference to an object-16] = [NONE]
      Move Object to be moved [NONE] Folder to move it into [NONE]
      For all icons in  [NONE] Recursive [FALSE] Child reference [Reference to an object-17] From list [FALSE] of type [NONE]  [<???>]
         Get Ymin value of data  [$Ymin] = Ymin value of [NONE]
         Get Ymax value of data  [$Ymax] = Ymax value of [NONE]
         Get Xmin value of data  [$Xmin] = Xmin value of [NONE]
         Get Xmax value of data  [$Xmax] = Xmax value of [NONE]
         If  [$X>$Xmin AND $X<$Xmax AND $Y>$Ymin AND $Y<$Ymax]
            Break
         Endif
      End loop
      Comments  [Variabile I > L is the Polygon containing the Culmination]
      Set reference  [Reference to an object-18] = [NONE]
      Get area of closed polygons  [$Area] = Area of polygon(s) [NONE]
      If  [$Area=0]
         Break
      Endif
      Comments  [Variable AL = previous Polygon]
      Copy A reference subject [Reference to an object-19] = [NONE] Folder to copy it into [NONE]
      Numeric expression  [$AreaPR] = [$Area]
   End loop
   Create boundary  [NONE] Expand [0]
   Set reference  [Reference to an object-20] = [NONE]
   Comments  [SP = value of the contour of the first open polygon]
   Get Zmin value of data  [$SP] = Zmin value of [NONE]
   Comments  [Spill Point = SP - 2 meters; meaning the value of the contour of the previous polygon (LCC)]
   Numeric expression  [$SpillPoint] = [$SP+2]
   Comments  [Thickness TOTAL = from Culmination to Spill Point]
   Numeric expression  [$ThicknessTOT] = [$Culmination-$SpillPoint]
   Comments  [Calculate Volume below DEPTH SIMULATED MAP N and above SPILL POINT]
   Volume below surface (constant level)  [$VolumeTOT] = Volume below surface [NONE] Base level [UNDEF] Boundary [NONE] Fast computation [TRUE]
   Comments  [Update isoprobability map adding value 1 only inside the closure]
   Eliminate outside  [NONE] The boundary [NONE]
   Z = Constant  [NONE] Constant [0.4]
   Z = Z + Surface(x,y)  [NONE] Surface [NONE] Eliminate outside [FALSE]
   Extrapolate within boundary  [NONE] Min curvature [TRUE] Boundary [Lines/polygons-1] Clear within boundary first [FALSE]
   Z = Constant  [NONE] Constant [0]
   Comments  [END of Isoprobability map UPDATE]
   Set reference  [Reference to an object-21] = [Regular surface-6]
   Z = Normal(Z, Constant)  [NONE] Constant [5]
   Z < Constant  [NONE] Constant [10] Exact intersection [FALSE]
   Get Zmin value of data  [$Thickness] = Zmin value of [NONE]
   Set reference  [Reference to an object-22] = [NONE]
   Z = Z - Constant  [NONE] Constant [UNDEF]
   Volume below surface (constant level)  [$VolumeBase] = Volume below surface [NONE] Base level [UNDEF] Boundary [NONE] Fast computation [TRUE]
   Numeric expression  [$Volume] = [$VolumeTOT-$VolumeBase]
   Output sheet Row [1] Column [1]  [Map Number] Bold [TRUE] Sheet []
   Output sheet Row [1] Column [2]  [Volume TOT] Bold [TRUE] Sheet []
   Output sheet Row [1] Column [3]  [Volume Base] Bold [TRUE] Sheet []
   Output sheet Row [1] Column [4]  [VOLUME] Bold [TRUE] Sheet []
   Output sheet Row [1] Column [5]  [Area] Bold [TRUE] Sheet []
   Output sheet Row [1] Column [6]  [Thickness TOT] Bold [TRUE] Sheet []
   Output sheet Row [1] Column [7]  [Spill Point] Bold [TRUE] Sheet []
   Output sheet Row [1] Column [8]  [Thickness] Bold [TRUE] Sheet []
   Output sheet Row [UNDEF] Column [1]  [$N] Bold [FALSE] Sheet []
   Output sheet Row [UNDEF] Column [2]  [$VolumeTOT] Bold [FALSE] Sheet []
   Output sheet Row [UNDEF] Column [3]  [$VolumeBase] Bold [FALSE] Sheet []
   Output sheet Row [UNDEF] Column [4]  [$Volume] Bold [FALSE] Sheet []
   Output sheet Row [UNDEF] Column [5]  [$AreaPR] Bold [FALSE] Sheet []
   Output sheet Row [UNDEF] Column [6]  [$ThicknessTOT] Bold [FALSE] Sheet []
   Output sheet Row [UNDEF] Column [7]  [$SpillPoint] Bold [FALSE] Sheet []
   Output sheet Row [UNDEF] Column [8]  [$Thickness] Bold [FALSE] Sheet []
End loop
